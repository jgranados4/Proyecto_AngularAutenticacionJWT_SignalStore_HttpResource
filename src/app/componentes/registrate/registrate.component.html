<form class="box" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
  <h3 class="title is-4 has-text-centered mb-5">Crear Cuenta</h3>

  <!-- Campo Nombre -->
  <div class="field">
    <label class="label">Nombre</label>
    <div class="control has-icons-left">
      <input class="input" type="text" formControlName="nombre" placeholder="Tu nombre completo"
             [class.is-danger]="f.nombre.invalid && f.nombre.touched">
      <span class="icon is-small is-left"><i class="fas fa-user"></i></span>
    </div>
    @if (f.nombre.hasError('required') && f.nombre.touched) {
      <p class="help is-danger">El nombre es requerido</p>
    }
  </div>

  <!-- Campo Password -->
  <div class="field">
    <label class="label">Contraseña</label>
    <div class="control has-icons-left">
      <input class="input" type="password" formControlName="password" placeholder="********"
             [class.is-danger]="f.password.invalid && f.password.touched">
      <span class="icon is-small is-left"><i class="fas fa-lock"></i></span>
    </div>
    
    <!-- Indicador de Fortaleza -->
    @if (passwordStrength(); as st) {
      <div class="mt-2">
        <progress class="progress is-small {{st.color}}" [value]="st.val" max="100"></progress>
        <p class="help {{st.color}} has-text-right">Fortaleza: <strong>{{st.label}}</strong></p>
      </div>
    }

    <!-- Errores Password (Frontend & Backend) -->
    @if (f.password.touched && f.password.invalid) {
      <div class="help is-danger">
        @if (f.password.hasError('required')) { <span>La contraseña es obligatoria.</span> }
        @if (f.password.hasError('minlength')) { <span>Mínimo 8 caracteres.</span> }
        @if (f.password.hasError('backend')) { <span>{{ f.password.getError('backend') }}</span> }
        <!-- Puedes agregar más mensajes específicos si tu validator los devuelve -->
      </div>
    }
  </div>

  <!-- Campo Email -->
  <div class="field">
    <label class="label">Email</label>
    <div class="control has-icons-left">
      <input class="input" type="email" formControlName="email" placeholder="ejemplo@correo.com"
             [class.is-danger]="f.email.invalid && f.email.touched">
      <span class="icon is-small is-left"><i class="fas fa-envelope"></i></span>
    </div>
    @if (f.email.invalid && f.email.touched) {
      <p class="help is-danger">Email inválido o requerido</p>
    }
  </div>

  <!-- Campo Rol -->
  <div class="field">
    <label class="label">Rol</label>
    <div class="control">
      <label class="radio">
        <input type="radio" formControlName="rol" value="cliente"> Cliente
      </label>
      <label class="radio">
        <input type="radio" formControlName="rol" value="Administrador"> Administrador
      </label>
    </div>
  </div>

  <!-- Botón -->
  <div class="field mt-5">
    <button type="submit" class="button is-success is-fullwidth" 
            [class.is-loading]="isLoading()" 
            [disabled]="registerForm.invalid || isLoading()">
      Registrarse
    </button>
  </div>
</form>