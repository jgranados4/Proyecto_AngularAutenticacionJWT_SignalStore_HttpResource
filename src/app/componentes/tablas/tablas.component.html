<!-- ============================================ -->
<!-- 📁 tablas.component.html -->
<!-- ============================================ -->

<section class="table-container" id="tabla1">
  <table class="table">
    <caption class="title is-2">
      Tabla de Usuarios
    </caption>

    <thead>
      <tr>
        <th>Id</th>
        <th><abbr title="Nombre">Nombre</abbr></th>
        <th>Email</th>
        <th>Rol</th>
        <th style="text-align: center">
          Acciones
          <span class="icon">
            <fa-icon
              [ngClass]="{ 'fa-beat': clickAnimation() }"
              (mouseenter)="activarAnimacion()"
              [icon]="faRepeat"
              (click)="recargar()"
            ></fa-icon>
          </span>
        </th>
      </tr>
    </thead>

    <tbody>
      <!-- ✅ @let para obtener data del store -->
      @let usuarios = store.usuarios();
      @defer (when usuarios) {
         <!-- ✅ @for con track optimizado -->
      @for (usuario of usuarios; track trackByUsuarioId($index, usuario)) {
      <tr>
        <!-- ✅ Modo lectura vs modo edición -->
        @if (!estaEditando(usuario.id!)) {
        <!-- Modo Lectura -->
        <th>{{ usuario.id }}</th>
        <td>{{ usuario.nombre }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.rol }}</td>
        <td>
          <button
            class="button is-link is-small"
            (click)="iniciarEdicion(usuario)"
            type="button"
          >
            Editar
          </button>
          <button
            class="button is-danger is-small ml-2"
            (click)="eliminar(usuario.id!)"
            type="button"
          >
            Borrar
          </button>
        </td>
        } @else {
        <!-- Modo Edición con Reactive Forms -->
        <th>{{ usuario.id }}</th>
        <td>
          <input
            class="input is-small"
            type="text"
            [formControl]="editForm.controls.nombre"
            [class.is-danger]="
              editForm.controls.nombre.invalid &&
              editForm.controls.nombre.touched
            "
          />
        </td>
        <td>
          <input
            class="input is-small"
            type="email"
            [formControl]="editForm.controls.email"
            [class.is-danger]="
              editForm.controls.email.invalid && editForm.controls.email.touched
            "
          />
        </td>
        <td>
          <input
            class="input is-small"
            type="text"
            [formControl]="editForm.controls.rol"
            [class.is-danger]="
              editForm.controls.rol.invalid && editForm.controls.rol.touched
            "
          />
        </td>
        <td>
          <button
            class="button is-success is-small"
            (click)="guardarEdicion(usuario.id!)"
            [disabled]="editForm.invalid"
            type="button"
          >
            Guardar
          </button>
          <button
            class="button is-warning is-small ml-2"
            (click)="cancelarEdicion()"
            type="button"
          >
            Cancelar
          </button>
        </td>
        }
      </tr>
      } @empty {
      <!-- ✅ Bloque @empty para lista vacía -->
      <tr>
        <td colspan="5" class="has-text-centered">
          <p class="has-text-grey">No hay usuarios registrados</p>
        </td>
      </tr>
      }
      }@placeholder {
        <div>
          datos de Usuarios
        </div>
      }
     
    </tbody>

    <!-- ✅ Acciones globales -->
    <tfoot>
      <tr>
        <td colspan="5">
          <div class="buttons">
            <button class="button is-info" (click)="recargar()" type="button">
              <span class="icon">
                <i class="fas fa-sync"></i>
              </span>
              <span>Recargar</span>
            </button>

            <button
              class="button is-light"
              (click)="volverHome()"
              type="button"
            >
              <span class="icon">
                <i class="fas fa-home"></i>
              </span>
              <span>Volver a Home</span>
            </button>
          </div>
        </td>
      </tr>
    </tfoot>
  </table>
</section>
